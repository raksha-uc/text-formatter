<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>CodeCraft Studio</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch_uncompressed.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            'bg': '#1a1b1e',
                            'card': '#25262b',
                            'border': '#2c2e33',
                            'text': '#c1c2c5',
                            'heading': '#ffffff'
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            @apply bg-blue-50 dark:bg-dark-bg text-gray-900 dark:text-dark-text;
            @apply overflow-hidden;
        }
        .editor-height {
            height: calc(100vh - 180px);
        }
        .main-content {
            height: calc(100vh - 64px);
            @apply overflow-y-auto;
        }
        .editor-container {
            @apply bg-white dark:bg-dark-card;
            @apply border-2 border-gray-200 dark:border-dark-border;
            border-radius: 0.75rem;
            overflow: hidden;
            @apply shadow-sm flex flex-col;
        }
        .panel-header {
            @apply bg-blue-400 dark:bg-indigo-900;
            @apply border-b-2 border-gray-200 dark:border-dark-border;
            @apply px-4 py-2;
            @apply font-semibold text-sm text-gray-900 dark:text-dark-text;
            flex-shrink: 0;
        }
        .action-btn {
            @apply inline-flex items-center gap-x-1.5 rounded-md px-2.5 py-1.5 text-sm font-semibold shadow-sm;
            @apply focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2;
        }
        .action-btn.primary {
            @apply bg-indigo-600 text-white hover:bg-indigo-500 focus-visible:outline-indigo-600;
        }
        .action-btn.secondary {
            @apply bg-white text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50;
        }
        .json-tree {
            @apply font-mono text-sm leading-6 p-4;
        }
        .json-tree .item {
            @apply py-0.5;
        }
        .json-tree .toggle {
            @apply cursor-pointer select-none inline-block w-5 text-center transition-transform;
        }
        .json-tree .key {
            @apply text-purple-600 font-medium;
        }
        .json-tree .string {
            @apply text-blue-600;
        }
        .json-tree .number {
            @apply text-amber-600;
        }
        .json-tree .boolean {
            @apply text-green-600;
        }
        .json-tree .null {
            @apply text-red-600;
        }
        .json-tree .indent {
            @apply ml-6;
        }
        .json-tree .collapsed {
            @apply hidden;
        }
        .json-controls {
            @apply flex gap-2 mb-4 sticky top-0 bg-white py-2 border-b border-gray-200;
        }
        .json-controls button {
            @apply px-3 py-1.5 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-500;
            @apply focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors;
        }
        .json-tree .array-length,
        .json-tree .object-length {
            @apply text-gray-500 text-xs;
        }
        .diff-view {
            @apply font-mono text-sm leading-6 whitespace-pre-wrap;
            height: 100%;
            overflow-y: auto;
        }
        .diff-view .diff-added {
            @apply bg-green-100 text-green-800;
        }
        .diff-view .diff-removed {
            @apply bg-red-100 text-red-800;
        }
        .diff-view .line-number {
            @apply text-gray-500 select-none pr-4 border-r border-gray-200 mr-4;
            min-width: 3rem;
            text-align: right;
            flex-shrink: 0;
        }
        .diff-line {
            @apply py-1 px-2;
            display: flex;
            align-items: flex-start;
        }
        .diff-content {
            flex: 1;
            word-break: break-all;
            white-space: pre-wrap;
        }
        .diff-panel {
            @apply h-full flex flex-col;
        }
        .xml-formatted {
            @apply font-mono text-sm leading-6 whitespace-pre-wrap;
        }
        .xml-tag {
            @apply text-purple-600 font-medium;
        }
        .xml-attribute {
            @apply text-blue-600;
        }
        .xml-attribute-value {
            @apply text-green-600;
        }
        .tool-card {
            @apply bg-white dark:bg-dark-card;
            @apply border-2 border-gray-200 dark:border-dark-border hover:border-indigo-500;
            @apply p-6 rounded-xl shadow-lg transition-all duration-300 cursor-pointer;
            @apply transform hover:-translate-y-1;
        }
        .tool-card .icon {
            @apply bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300;
        }
        .tool-card h3 {
            @apply text-gray-900 dark:text-dark-heading;
        }
        .tool-card p {
            @apply text-gray-600 dark:text-dark-text;
        }
        .home-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .dropdown {
            @apply relative inline-block;
        }
        .dropdown-content {
            @apply hidden absolute right-0 mt-2 w-48 rounded-md bg-white dark:bg-dark-card shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none;
            z-index: 50;
        }
        .dropdown-content.show {
            @apply block;
        }
        .dropdown-item {
            @apply block px-4 py-2 text-sm text-gray-700 dark:text-dark-text hover:bg-gray-100 dark:hover:bg-dark-border cursor-pointer;
        }
    </style>
    <script>
        // Add this at the start of your script section
        let currentMode = 'home'; // 'home', 'html', 'json', 'diff', or 'python'
        
        function switchMode(mode) {
            currentMode = mode;
            const mainContent = document.querySelector('.main-content > div');
            const heroTitle = document.getElementById('heroTitle');
            const heroSubtitle = document.getElementById('heroSubtitle');
            const navLinks = document.querySelector('.nav-links');
            
            // Show/hide navigation links based on mode
            if (mode === 'home') {
                navLinks.classList.add('hidden');
                heroTitle.textContent = 'CodeCraft Studio';
                heroSubtitle.textContent = 'Your Ultimate Code Transformation Hub';
                document.title = 'CodeCraft Studio';
                
                mainContent.innerHTML = `
                    <div class="rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 p-6 shadow-xl mb-4">
                        <h2 id="heroTitle" class="text-3xl font-bold tracking-tight text-white sm:text-4xl">CodeCraft Studio</h2>
                        <p id="heroSubtitle" class="mt-2 text-lg text-blue-100">Your Ultimate Code Transformation Hub</p>
                    </div>
                    <div class="home-grid">
                        <div class="tool-card" onclick="switchMode('html')">
                            <div class="icon">
                                <i class="material-icons">code</i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">HTML Beautifier</h3>
                            <p class="text-gray-600">Format, validate, and preview HTML code with syntax highlighting.</p>
                        </div>
                        
                        <div class="tool-card" onclick="switchMode('json')">
                            <div class="icon">
                                <i class="material-icons">data_object</i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">JSON Beautifier</h3>
                            <p class="text-gray-600">Format and validate JSON with an interactive tree view.</p>
                        </div>
                        
                        <div class="tool-card" onclick="switchMode('diff')">
                            <div class="icon">
                                <i class="material-icons">compare</i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Diff Checker</h3>
                            <p class="text-gray-600">Compare text differences with highlighted changes.</p>
                        </div>
                        
                        <div class="tool-card" onclick="switchMode('python')">
                            <div class="icon">
                                <i class="material-icons">transform</i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">JSON to Python</h3>
                            <p class="text-gray-600">Convert JSON to Python dictionary with proper formatting.</p>
                        </div>
                    </div>
                `;
            } else {
                navLinks.classList.remove('hidden');
                
                // Set up the header based on mode
                if (mode === 'html') {
                heroTitle.textContent = 'HTML Viewer';
                heroSubtitle.textContent = 'Try HTML Editor';
                document.title = 'HTML Viewer';
                
                mainContent.innerHTML = `
                        <div class="rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 p-6 shadow-xl mb-4">
                            <h2 id="heroTitle" class="text-3xl font-bold tracking-tight text-white sm:text-4xl">HTML Viewer</h2>
                            <p id="heroSubtitle" class="mt-2 text-lg text-blue-100">Try HTML Editor</p>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 h-full">
                    <div class="lg:col-span-5">
                        <div class="editor-container h-full">
                            <div class="panel-header flex justify-between items-center">
                                <span>HTML Input</span>
                                <div class="flex items-center space-x-2">
                                    <button onclick="copyInput()" class="action-btn secondary" title="Copy">
                                        <i class="material-icons text-base">content_copy</i>
                                    </button>
                                    <button onclick="checkInput()" class="action-btn secondary" title="Validate">
                                        <i class="material-icons text-base">check</i>
                                    </button>
                                    <button onclick="clearInput('htmlInput')" class="action-btn secondary" title="Clear">
                                        <i class="material-icons text-base">delete</i>
                                    </button>
                                </div>
                            </div>
                            <textarea id="htmlInput" class="w-full editor-height p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" 
                                placeholder="Enter your HTML here..."></textarea>
                        </div>
                    </div>

                    <div class="lg:col-span-2 flex lg:flex-col justify-center items-center gap-3">
                        <button onclick="updatePreview()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-green-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
                            <i class="material-icons">play_arrow</i>
                            RUN
                        </button>
                        <button onclick="formatHTML()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                            <i class="material-icons">format_paint</i>
                            Format
                        </button>
                        <button onclick="downloadHTML()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-gray-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">
                            <i class="material-icons">download</i>
                            Download
                        </button>
                    </div>

                    <div class="lg:col-span-5">
                        <div class="editor-container h-full">
                            <div class="panel-header flex justify-between items-center">
                                <span>HTML Output</span>
                                <div class="flex items-center space-x-2">
                                    <button onclick="copyOutput()" class="action-btn secondary" title="Copy">
                                        <i class="material-icons text-base">content_copy</i>
                                    </button>
                                </div>
                            </div>
                            <iframe id="preview" class="w-full h-full border-none"></iframe>
                        </div>
                    </div>
                </div>
            `;
                    
                    // Initialize preview with empty message
                    const preview = document.getElementById('preview');
                    preview.contentDocument.open();
                    preview.contentDocument.write('<p class="text-gray-500 text-center p-4">Click RUN to preview your HTML</p>');
                    preview.contentDocument.close();
                    
                } else if (mode === 'json') {
                    heroTitle.textContent = 'JSON Beautifier';
                    heroSubtitle.textContent = 'Try JSON Editor';
                    document.title = 'JSON Beautifier';
                    
                    mainContent.innerHTML = `
                        <div class="rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 p-6 shadow-xl mb-4">
                            <h2 id="heroTitle" class="text-3xl font-bold tracking-tight text-white sm:text-4xl">JSON Beautifier</h2>
                            <p id="heroSubtitle" class="mt-2 text-lg text-blue-100">Try JSON Editor</p>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 h-full">
                            <div class="lg:col-span-5">
                                <div class="editor-container h-full">
                                    <div class="panel-header flex justify-between items-center">
                                        <span>JSON Input</span>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="copyInput()" class="action-btn secondary" title="Copy">
                                                <i class="material-icons text-base">content_copy</i>
                                            </button>
                                            <button onclick="clearInput('jsonInput')" class="action-btn secondary" title="Clear">
                                                <i class="material-icons text-base">delete</i>
                                            </button>
                                        </div>
                                    </div>
                                    <textarea id="jsonInput" class="w-full editor-height p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" 
                                        placeholder="Enter your JSON here..."></textarea>
                                </div>
                            </div>

                            <div class="lg:col-span-2 flex lg:flex-col justify-center items-center gap-3">
                                <button onclick="formatJSON()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                                    <i class="material-icons">format_paint</i>
                                    Format JSON
                                </button>
                            </div>

                            <div class="lg:col-span-5">
                                <div class="editor-container h-full">
                                    <div class="panel-header flex justify-between items-center">
                                        <span>Formatted JSON</span>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="copyOutput()" class="action-btn secondary" title="Copy">
                                                <i class="material-icons text-base">content_copy</i>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="jsonOutput" class="w-full editor-height p-4 font-mono text-sm overflow-auto"></div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (mode === 'diff') {
                    heroTitle.textContent = 'Diff Checker';
                    heroSubtitle.textContent = 'Compare Text Differences';
                    document.title = 'Diff Checker';
                    
                    mainContent.innerHTML = `
                        <div class="rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 p-6 shadow-xl mb-4">
                            <h2 id="heroTitle" class="text-3xl font-bold tracking-tight text-white sm:text-4xl">Diff Checker</h2>
                            <p id="heroSubtitle" class="mt-2 text-lg text-blue-100">Compare Text Differences</p>
                        </div>
                        <div class="lg:col-span-12">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(40vh-80px)]">
                                <div class="editor-container h-full">
                                    <div class="panel-header flex justify-between items-center">
                                        <span>Original Text</span>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="clearInput('originalText')" class="action-btn secondary" title="Clear">
                                                <i class="material-icons text-base">delete</i>
                                            </button>
                                        </div>
                                    </div>
                                    <textarea id="originalText" class="w-full h-full p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none resize-none" 
                                        placeholder="Enter original text here..."></textarea>
                                </div>
                                <div class="editor-container h-full">
                                    <div class="panel-header flex justify-between items-center">
                                        <span>Modified Text</span>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="clearInput('modifiedText')" class="action-btn secondary" title="Clear">
                                                <i class="material-icons text-base">delete</i>
                                            </button>
                                        </div>
                                    </div>
                                    <textarea id="modifiedText" class="w-full h-full p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none resize-none" 
                                        placeholder="Enter modified text here..."></textarea>
                                </div>
                            </div>
                            <div class="flex justify-center my-4">
                                <button onclick="showDiff()" class="inline-flex items-center gap-x-2 rounded-lg bg-indigo-600 px-8 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                                    <i class="material-icons">compare</i>
                                    Compare
                                </button>
                            </div>
                            <div class="editor-container h-[calc(40vh-80px)]">
                                <div class="panel-header flex justify-between items-center">
                                    <span>Differences</span>
                                    <div class="flex items-center space-x-2">
                                        <button onclick="copyDiff()" class="action-btn secondary" title="Copy">
                                            <i class="material-icons text-base">content_copy</i>
                                        </button>
                                    </div>
                                </div>
                                <div id="diffOutput" class="w-full h-full p-4 font-mono text-sm overflow-auto"></div>
                            </div>
                        </div>
                    `;
                } else if (mode === 'python') {
                    heroTitle.textContent = 'JSON to Python';
                    heroSubtitle.textContent = 'Convert JSON to Python Dictionary';
                    document.title = 'JSON to Python Converter';
                    
                    mainContent.innerHTML = `
                        <div class="rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 p-6 shadow-xl mb-4">
                            <h2 id="heroTitle" class="text-3xl font-bold tracking-tight text-white sm:text-4xl">JSON to Python</h2>
                            <p id="heroSubtitle" class="mt-2 text-lg text-blue-100">Convert JSON to Python Dictionary</p>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 h-full">
                            <div class="lg:col-span-5">
                                <div class="editor-container h-full">
                                    <div class="panel-header flex justify-between items-center">
                                        <span>JSON Input</span>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="copyInput()" class="action-btn secondary" title="Copy">
                                                <i class="material-icons text-base">content_copy</i>
                                            </button>
                                            <button onclick="clearInput('jsonInput')" class="action-btn secondary" title="Clear">
                                                <i class="material-icons text-base">delete</i>
                                            </button>
                                        </div>
                                    </div>
                                    <textarea id="jsonInput" class="w-full editor-height p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" 
                                        placeholder="Enter your JSON here..."></textarea>
                                </div>
                            </div>

                            <div class="lg:col-span-2 flex lg:flex-col justify-center items-center gap-3">
                                <button onclick="convertToPython()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                                    <i class="material-icons">code</i>
                                    Convert
                                </button>
                            </div>

                            <div class="lg:col-span-5">
                                <div class="editor-container h-full">
                                    <div class="panel-header flex justify-between items-center">
                                        <span>Python Dictionary</span>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="copyOutput()" class="action-btn secondary" title="Copy">
                                                <i class="material-icons text-base">content_copy</i>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="pythonOutput" class="w-full editor-height p-4 font-mono text-sm overflow-auto"></div>
                                </div>
                        </div>
                    </div>
                `;
                }
            }
        }

        function formatJSON() {
            const input = document.getElementById('jsonInput');
            const output = document.getElementById('jsonOutput');
            let json = input.value.trim();
            
            try {
                const parsed = JSON.parse(json);
                output.innerHTML = '<div class="json-controls">' +
                    '<button onclick="expandAll()">Expand All</button>' +
                    '<button onclick="collapseAll()">Collapse All</button>' +
                    '</div>' +
                    '<div class="json-tree">' + renderTree(parsed) + '</div>';

                // Add the tree interaction functions
                const script = document.createElement('script');
                script.textContent = 'function toggleNode(el) {' +
                    'const content = el.nextElementSibling;' +
                    'const arrow = el.querySelector(".toggle");' +
                    'if (content.classList.contains("collapsed")) {' +
                    'content.classList.remove("collapsed");' +
                    'arrow.style.transform = "rotate(90deg)";' +
                    '} else {' +
                    'content.classList.add("collapsed");' +
                    'arrow.style.transform = "rotate(0deg)";' +
                    '}}' +
                    'function expandAll() {' +
                    'document.querySelectorAll(".collapsed").forEach(el => {' +
                    'el.classList.remove("collapsed");' +
                    '});' +
                    'document.querySelectorAll(".toggle").forEach(el => {' +
                    'el.style.transform = "rotate(90deg)";' +
                    '});}' +
                    'function collapseAll() {' +
                    'document.querySelectorAll(".json-tree .indent").forEach(el => {' +
                    'el.classList.add("collapsed");' +
                    '});' +
                    'document.querySelectorAll(".toggle").forEach(el => {' +
                    'el.style.transform = "rotate(0deg)";' +
                    '});}';
                document.body.appendChild(script);
            } catch (e) {
                output.innerHTML = '<div class="text-red-600">Invalid JSON: ' + e.message + '</div>';
            }
        }

        function renderTree(data) {
            if (data === null) {
                return '<span class="null">null</span>';
            }
            if (typeof data === 'string') {
                return '<span class="string">"' + escapeHTML(data) + '"</span>';
            }
            if (typeof data === 'number') {
                return '<span class="number">' + data + '</span>';
            }
            if (typeof data === 'boolean') {
                return '<span class="boolean">' + data + '</span>';
            }
            
            if (Array.isArray(data)) {
                if (data.length === 0) {
                    return '[]';
                }
                
                const items = data.map((item, i) => 
                    '<div class="item">' + renderTree(item) + (i < data.length - 1 ? ',' : '') + '</div>'
                ).join('');
                
                return '<div class="array">' +
                    '<div class="item" onclick="toggleNode(this)">' +
                    '<span class="toggle">▶</span>[' +
                    '<span class="array-length">' + data.length + ' items</span>' +
                    '</div>' +
                    '<div class="indent collapsed">' + items + '</div>' +
                    '<div class="item">]</div>' +
                    '</div>';
            }
            
            if (typeof data === 'object') {
                const keys = Object.keys(data);
                if (keys.length === 0) {
                    return '{}';
                }
                
                const items = keys.map((key, i) => 
                    '<div class="item">' +
                    '<span class="key">"' + escapeHTML(key) + '"</span>: ' + renderTree(data[key]) + (i < keys.length - 1 ? ',' : '') +
                    '</div>'
                ).join('');
                
                return '<div class="object">' +
                    '<div class="item" onclick="toggleNode(this)">' +
                    '<span class="toggle">▶</span>{' +
                    '<span class="object-length">' + keys.length + ' keys</span>' +
                    '</div>' +
                    '<div class="indent collapsed">' + items + '</div>' +
                    '<div class="item">}</div>' +
                    '</div>';
            }
            
            return String(data);
        }

        function escapeHTML(str) {
            var div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function showDiff() {
            const originalText = document.getElementById('originalText').value;
            const modifiedText = document.getElementById('modifiedText').value;
            const diffOutput = document.getElementById('diffOutput');
            
            if (!originalText && !modifiedText) {
                diffOutput.innerHTML = '<div class="text-gray-500 text-center p-4">Enter text in both panels to compare differences</div>';
                return;
            }
            
            if (!originalText || !modifiedText) {
                diffOutput.innerHTML = '<div class="text-red-600">Please enter text in both panels to compare</div>';
                return;
            }
            
            try {
                // Check if diff_match_patch is loaded
                if (typeof diff_match_patch === 'undefined') {
                    throw new Error('Diff library not loaded. Please refresh the page and try again.');
                }

                const dmp = new diff_match_patch();
                if (!dmp) {
                    throw new Error('Failed to initialize diff tool. Please refresh the page and try again.');
                }

                const diffs = dmp.diff_main(originalText, modifiedText);
                dmp.diff_cleanupSemantic(diffs);
                
                let html = '<div class="diff-view">';
                let lineNumber = 1;
                let currentLine = '';
                let diffType = null;
                
                // Process diffs line by line
                diffs.forEach(([type, text]) => {
                    const lines = text.split('\n');
                    
                    lines.forEach((line, index) => {
                        const isLastLine = index === lines.length - 1;
                        
                        // Handle empty lines
                        if (!line && !isLastLine) {
                            if (diffType !== null) {
                                // Output the current line before starting a new one
                                html += formatDiffLine(currentLine, diffType, lineNumber);
                                currentLine = '';
                                diffType = null;
                                lineNumber++;
                            }
                            // Output empty line
                            html += formatDiffLine('', type, lineNumber);
                            lineNumber++;
                            return;
                        }
                        
                        // If we're starting a new diff type or line
                        if (diffType === null) {
                            diffType = type;
                            currentLine = line;
                        } else if (diffType === type) {
                            // Same diff type, append to current line
                            currentLine += line;
                        } else {
                            // Different diff type, output current line and start new one
                            html += formatDiffLine(currentLine, diffType, lineNumber);
                            currentLine = line;
                            diffType = type;
                        }
                        
                        // If this is the last line of the current diff segment
                        if (isLastLine) {
                            if (currentLine || type === 0) { // Output if there's content or it's an unchanged line
                                html += formatDiffLine(currentLine, diffType, lineNumber);
                                lineNumber++;
                            }
                            currentLine = '';
                            diffType = null;
                        }
                    });
                });
                
                html += '</div>';
                
                // Add styles for the diff view
                const styles = '<style>' +
                    '.diff-view { font-family: ui-monospace, monospace; font-size: 14px; line-height: 1.5; }' +
                    '.diff-line { white-space: pre-wrap; word-wrap: break-word; margin: 2px 0; padding: 0 8px; }' +
                    '.diff-added { background: #dcfce7; color: #166534; }' +
                    '.diff-removed { background: #fee2e2; color: #991b1b; }' +
                    '.diff-unchanged { background: transparent; }' +
                    '.line-number { color: #6b7280; user-select: none; padding-right: 16px; margin-right: 16px; ' +
                    'border-right: 1px solid #e5e7eb; display: inline-block; width: 48px; text-align: right; }' +
                    '</style>';
                
                diffOutput.innerHTML = styles + html;
            } catch (error) {
                console.error('Error in showDiff:', error);
                diffOutput.innerHTML = '<div class="text-red-600">Error comparing texts: ' + error.message + '</div>';
            }
        }

        function formatDiffLine(text, type, lineNumber) {
            const escapedText = escapeHTML(text);
            const diffClass = type === 0 ? 'diff-unchanged' : (type === 1 ? 'diff-added' : 'diff-removed');
            return '<div class="diff-line ' + diffClass + '">' +
                '<span class="line-number">' + lineNumber + '</span>' +
                escapedText +
                '</div>';
        }

        function copyInput() {
            const input = document.getElementById('jsonInput');
            input.select();
            document.execCommand('copy');
        }

        function copyOutput() {
            const output = document.getElementById('jsonOutput');
            if (output) {
                const range = document.createRange();
                range.selectNode(output);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand('copy');
                window.getSelection().removeAllRanges();
            }
        }

        function clearInput(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.value = '';
            }
        }

        function checkInput() {
            const input = document.getElementById('htmlInput').value;
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(input, 'text/html');
                const errors = doc.getElementsByTagName('parsererror');
                if (errors.length > 0) {
                    throw new Error('Invalid HTML');
                }
                alert('HTML is valid!');
            } catch (e) {
                alert('Invalid HTML: ' + e.message);
            }
        }

        function updatePreview() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            const html = input.value.trim();
            
            if (html) {
                preview.contentDocument.open();
                preview.contentDocument.write(html);
                preview.contentDocument.close();
            } else {
                preview.contentDocument.open();
                preview.contentDocument.write('<p class="text-gray-500 text-center p-4">Click RUN to preview your HTML</p>');
                preview.contentDocument.close();
            }
        }

        function formatHTML() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            let html = input.value;
            
            try {
                // Parse the HTML using DOMParser
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Format the complete HTML document
                let formatted = '';
                
                // Add DOCTYPE if present
                if (html.toLowerCase().includes('<!doctype')) {
                    formatted += '<!DOCTYPE html>\n';
                }
                
                // Format the rest of the document
                formatted += formatNode(doc.documentElement, 0);
                
                // Display formatted HTML in the preview with syntax highlighting
                preview.contentDocument.open();
                preview.contentDocument.write(`
                    <pre style="margin: 0; padding: 16px; font-family: monospace; white-space: pre-wrap; font-size: 14px; line-height: 1.5; background: #f8f9fa;">
                        ${formatted.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                    </pre>
                `);
                preview.contentDocument.close();
            } catch (e) {
                alert('Error formatting HTML: ' + e.message);
            }
        }

        // Helper function to format HTML nodes
        function formatNode(node, level) {
            if (!node) return '';
            
            let result = '';
            const indent = '    '.repeat(level);

            // Handle text nodes
            if (node.nodeType === 3) {
                const text = node.textContent.trim();
                if (text) {
                    result += indent + text + '\n';
                }
                return result;
            }

            // Handle element nodes
            if (node.nodeType === 1) {
                const tagName = node.tagName.toLowerCase();
                
                // Get node attributes
                const attrs = Array.from(node.attributes)
                    .map(attr => `${attr.name}="${attr.value}"`)
                    .join(' ');

                // Special handling for style and script tags to preserve content formatting
                if (tagName === 'style' || tagName === 'script') {
                    result += indent + '<' + tagName + (attrs ? ' ' + attrs : '') + '>\n';
                    if (node.textContent.trim()) {
                        result += indent + '    ' + node.textContent.trim() + '\n';
                    }
                    result += indent + '</' + tagName + '>\n';
                    return result;
                }

                // Opening tag
                result += indent + '<' + tagName + 
                    (attrs ? ' ' + attrs : '') + 
                    (node.children.length || node.textContent.trim() ? '>\n' : '/>\n');

                // Handle children
                for (let child of node.childNodes) {
                    result += formatNode(child, level + 1);
                }

                // Closing tag if needed
                if (node.children.length || node.textContent.trim()) {
                    result += indent + '</' + tagName + '>\n';
                }
            }

            return result;
        }

        function downloadHTML() {
            const html = document.getElementById('htmlInput').value;
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'formatted.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function copyDiff() {
            const diffOutput = document.getElementById('diffOutput');
            const range = document.createRange();
            range.selectNode(diffOutput);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
        }

        function convertToPython() {
            const input = document.getElementById('jsonInput');
            const output = document.getElementById('pythonOutput');
            let json = input.value.trim();
            
            try {
                const parsed = JSON.parse(json);
                const pythonDict = jsonToPython(parsed, 0);
                output.innerHTML = '<pre class="language-python">' + pythonDict + '</pre>';
            } catch (e) {
                output.innerHTML = '<div class="text-red-600">Invalid JSON: ' + e.message + '</div>';
            }
        }

        function jsonToPython(obj, level) {
            const indent = '    '.repeat(level);
            
            if (obj === null) {
                return 'None';
            }
            if (typeof obj === 'string') {
                return `'${obj.replace(/'/g, "\\'")}'`;
            }
            if (typeof obj === 'number' || typeof obj === 'boolean') {
                return String(obj);
            }
            
            if (Array.isArray(obj)) {
                if (obj.length === 0) return '[]';
                
                const items = obj.map(item => jsonToPython(item, level + 1));
                if (items.join(', ').length <= 60) {
                    return `[${items.join(', ')}]`;
                }
                return '[\n' + items.map(item => indent + '    ' + item).join(',\n') + '\n' + indent + ']';
            }
            
            if (typeof obj === 'object') {
                const keys = Object.keys(obj);
                if (keys.length === 0) return '{}';
                
                const items = keys.map(key => {
                    const keyStr = /^[a-zA-Z_][a-zA-Z0-9_]*$/.test(key) ? key : `'${key}'`;
                    return `${keyStr}: ${jsonToPython(obj[key], level + 1)}`;
                });
                
                if (items.join(', ').length <= 60) {
                    return `{${items.join(', ')}}`;
                }
                return '{\n' + items.map(item => indent + '    ' + item).join(',\n') + '\n' + indent + '}';
            }
            
            return String(obj);
        }

        // Add theme toggle functionality
        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.querySelector('.theme-icon');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                themeIcon.textContent = 'light_mode';
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                themeIcon.textContent = 'dark_mode';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialize theme from localStorage
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const themeIcon = document.querySelector('.theme-icon');
            
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
                themeIcon.textContent = 'dark_mode';
            } else {
                themeIcon.textContent = 'light_mode';
            }
        });

        function toggleToolsMenu() {
            const dropdown = document.getElementById('toolsDropdown');
            dropdown.classList.toggle('show');
            
            // Close the dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                if (!e.target.closest('.dropdown')) {
                    dropdown.classList.remove('show');
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
    </script>
</head>
<body class="antialiased">
    <header class="bg-white dark:bg-dark-card shadow-sm h-16">
        <nav class="mx-auto flex max-w-7xl items-center justify-between p-4 lg:px-8" aria-label="Global">
            <div class="flex lg:flex-1">
            </div>
            <div class="flex lg:gap-x-8 nav-links hidden">
            </div>
            <div class="flex lg:flex-1 lg:justify-end items-center space-x-4">
                <button onclick="toggleTheme()" class="rounded-full p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-dark-border">
                    <i class="material-icons theme-icon">light_mode</i>
                    </button>
                <div class="dropdown">
                    <button onclick="toggleToolsMenu()" class="inline-flex items-center gap-x-1.5 rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                        <i class="material-icons text-sm">build</i>
                        Tools
                        <i class="material-icons text-sm">expand_more</i>
                    </button>
                    <div id="toolsDropdown" class="dropdown-content">
                        <a onclick="switchMode('html')" class="dropdown-item">
                            <div class="flex items-center">
                                <i class="material-icons text-sm mr-2">code</i>
                                HTML Beautifier
                    </div>
                        </a>
                        <a onclick="switchMode('json')" class="dropdown-item">
                            <div class="flex items-center">
                                <i class="material-icons text-sm mr-2">data_object</i>
                                JSON Beautifier
                </div>
                        </a>
                        <a onclick="switchMode('diff')" class="dropdown-item">
                            <div class="flex items-center">
                                <i class="material-icons text-sm mr-2">compare</i>
                                Diff Checker
                            </div>
                        </a>
                        <a onclick="switchMode('python')" class="dropdown-item">
                            <div class="flex items-center">
                                <i class="material-icons text-sm mr-2">transform</i>
                                JSON to Python
                            </div>
                        </a>
                    </div>
                </div>
                <button onclick="switchMode('home')" class="inline-flex items-center gap-x-1.5 rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                    <i class="material-icons text-sm">home</i>
                    Home
                </button>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="h-full px-4 py-4 sm:px-6 lg:px-8">
            <div class="rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 p-6 shadow-xl mb-4">
                <h2 id="heroTitle" class="text-3xl font-bold tracking-tight text-white sm:text-4xl">CodeCraft Studio</h2>
                <p id="heroSubtitle" class="mt-2 text-lg text-blue-100">Your Ultimate Code Transformation Hub</p>
            </div>

            <!-- Content will be dynamically inserted here -->
            <div class="home-grid">
                <div class="tool-card" onclick="switchMode('html')">
                    <div class="icon">
                        <i class="material-icons">code</i>
                            </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">HTML Beautifier</h3>
                    <p class="text-gray-600">Format, validate, and preview HTML code with syntax highlighting.</p>
                        </div>
                
                <div class="tool-card" onclick="switchMode('json')">
                    <div class="icon">
                        <i class="material-icons">data_object</i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">JSON Beautifier</h3>
                    <p class="text-gray-600">Format and validate JSON with an interactive tree view.</p>
                </div>

                <div class="tool-card" onclick="switchMode('diff')">
                    <div class="icon">
                        <i class="material-icons">compare</i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Diff Checker</h3>
                    <p class="text-gray-600">Compare text differences with highlighted changes.</p>
                </div>

                <div class="tool-card" onclick="switchMode('python')">
                    <div class="icon">
                        <i class="material-icons">transform</i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">JSON to Python</h3>
                    <p class="text-gray-600">Convert JSON to Python dictionary with proper formatting.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Remove the automatic preview update on input
        document.getElementById('htmlInput').removeEventListener('input', updatePreview);

        function updatePreview() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            const html = input.value.trim();
            
            if (html) {
                preview.contentDocument.open();
                preview.contentDocument.write(html);
                preview.contentDocument.close();
            } else {
                preview.contentDocument.open();
                preview.contentDocument.write('<p class="text-gray-500 text-center p-4">Click RUN to preview your HTML</p>');
                preview.contentDocument.close();
            }
        }

        // Initialize with empty preview message
        window.onload = function() {
            const preview = document.getElementById('preview');
            preview.contentDocument.open();
            preview.contentDocument.write('<p class="text-gray-500 text-center p-4">Click RUN to preview your HTML</p>');
            preview.contentDocument.close();
        };

        function formatHTML() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            let html = input.value;
            
            try {
                // Parse the HTML using DOMParser
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Format the complete HTML document
                let formatted = '';
                
                // Add DOCTYPE if present
                if (html.toLowerCase().includes('<!doctype')) {
                    formatted += '<!DOCTYPE html>\n';
                }
                
                // Format the rest of the document
                formatted += formatNode(doc.documentElement, 0);
                
                // Display formatted HTML in the preview with syntax highlighting
                preview.contentDocument.open();
                preview.contentDocument.write(`
                    <pre style="margin: 0; padding: 16px; font-family: monospace; white-space: pre-wrap; font-size: 14px; line-height: 1.5; background: #f8f9fa;">
                        ${formatted.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                    </pre>
                `);
                preview.contentDocument.close();
            } catch (e) {
                alert('Error formatting HTML: ' + e.message);
            }
        }

        // Helper function to format HTML nodes
        function formatNode(node, level) {
            if (!node) return '';
            
            let result = '';
            const indent = '    '.repeat(level);

            // Handle text nodes
            if (node.nodeType === 3) {
                const text = node.textContent.trim();
                if (text) {
                    result += indent + text + '\n';
                }
                return result;
            }

            // Handle element nodes
            if (node.nodeType === 1) {
                const tagName = node.tagName.toLowerCase();
                
                // Get node attributes
                const attrs = Array.from(node.attributes)
                    .map(attr => `${attr.name}="${attr.value}"`)
                    .join(' ');

                // Special handling for style and script tags to preserve content formatting
                if (tagName === 'style' || tagName === 'script') {
                    result += indent + '<' + tagName + (attrs ? ' ' + attrs : '') + '>\n';
                    if (node.textContent.trim()) {
                        result += indent + '    ' + node.textContent.trim() + '\n';
                    }
                    result += indent + '</' + tagName + '>\n';
                    return result;
                }

                // Opening tag
                result += indent + '<' + tagName + 
                    (attrs ? ' ' + attrs : '') + 
                    (node.children.length || node.textContent.trim() ? '>\n' : '/>\n');

                // Handle children
                for (let child of node.childNodes) {
                    result += formatNode(child, level + 1);
                }

                // Closing tag if needed
                if (node.children.length || node.textContent.trim()) {
                    result += indent + '</' + tagName + '>\n';
                }
            }

            return result;
        }

        function downloadHTML() {
            const html = document.getElementById('htmlInput').value;
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'formatted.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function copyInput() {
            const input = document.getElementById('htmlInput');
            input.select();
            document.execCommand('copy');
        }

        function copyOutput() {
            const preview = document.getElementById('preview');
            const content = preview.contentDocument.documentElement.outerHTML;
            const textarea = document.createElement('textarea');
            textarea.value = content;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        function clearInput() {
            document.getElementById('htmlInput').value = '';
            updatePreview();
        }

        function checkInput() {
            const input = document.getElementById('htmlInput').value;
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(input, 'text/html');
                const errors = doc.getElementsByTagName('parsererror');
                if (errors.length > 0) {
                    throw new Error('Invalid HTML');
                }
                alert('HTML is valid!');
            } catch (e) {
                alert('Invalid HTML: ' + e.message);
            }
        }

        let isFullscreen = false;
        function toggleFullscreen() {
            const previewContainer = document.getElementById('preview').parentElement.parentElement;
            if (!isFullscreen) {
                previewContainer.classList.remove('lg:col-span-5');
                previewContainer.classList.add('lg:col-span-7');
            } else {
                previewContainer.classList.remove('lg:col-span-7');
                previewContainer.classList.add('lg:col-span-5');
            }
            isFullscreen = !isFullscreen;
        }
    </script>
</body>
</html>