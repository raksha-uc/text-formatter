<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>HTML Viewer</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch_uncompressed.js"></script>
    <style type="text/tailwindcss">
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background: #e0f2fe;
            @apply overflow-hidden;
        }
        .editor-height {
            height: calc(100vh - 180px);
        }
        .main-content {
            height: calc(100vh - 64px);
            @apply overflow-y-auto;
        }
        .editor-container {
            background: #fff;
            border: 2px solid #1a1a1a;
            border-radius: 0.75rem;
            overflow: hidden;
            @apply shadow-sm flex flex-col;
        }
        .panel-header {
            background: #60a5fa;
            border-bottom: 2px solid #1a1a1a;
            @apply px-4 py-2;
            @apply font-semibold text-sm text-gray-900;
            flex-shrink: 0;
        }
        .action-btn {
            @apply inline-flex items-center gap-x-1.5 rounded-md px-2.5 py-1.5 text-sm font-semibold shadow-sm;
            @apply focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2;
        }
        .action-btn.primary {
            @apply bg-indigo-600 text-white hover:bg-indigo-500 focus-visible:outline-indigo-600;
        }
        .action-btn.secondary {
            @apply bg-white text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50;
        }
        .json-tree {
            @apply font-mono text-sm leading-6 p-4;
        }
        .json-tree .item {
            @apply py-0.5;
        }
        .json-tree .toggle {
            @apply cursor-pointer select-none inline-block w-5 text-center transition-transform;
        }
        .json-tree .key {
            @apply text-purple-600 font-medium;
        }
        .json-tree .string {
            @apply text-blue-600;
        }
        .json-tree .number {
            @apply text-amber-600;
        }
        .json-tree .boolean {
            @apply text-green-600;
        }
        .json-tree .null {
            @apply text-red-600;
        }
        .json-tree .indent {
            @apply ml-6;
        }
        .json-tree .collapsed {
            @apply hidden;
        }
        .json-controls {
            @apply flex gap-2 mb-4 sticky top-0 bg-white py-2 border-b border-gray-200;
        }
        .json-controls button {
            @apply px-3 py-1.5 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-500;
            @apply focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors;
        }
        .json-tree .array-length,
        .json-tree .object-length {
            @apply text-gray-500 text-xs;
        }
        .diff-view {
            @apply font-mono text-sm leading-6 whitespace-pre-wrap;
            height: 100%;
            overflow-y: auto;
        }
        .diff-view .diff-added {
            @apply bg-green-100 text-green-800;
        }
        .diff-view .diff-removed {
            @apply bg-red-100 text-red-800;
        }
        .diff-view .line-number {
            @apply text-gray-500 select-none pr-4 border-r border-gray-200 mr-4;
            min-width: 3rem;
            text-align: right;
            flex-shrink: 0;
        }
        .diff-line {
            @apply py-1 px-2;
            display: flex;
            align-items: flex-start;
        }
        .diff-content {
            flex: 1;
            word-break: break-all;
            white-space: pre-wrap;
        }
        .diff-panel {
            @apply h-full flex flex-col;
        }
        .xml-formatted {
            @apply font-mono text-sm leading-6 whitespace-pre-wrap;
        }
        .xml-tag {
            @apply text-purple-600 font-medium;
        }
        .xml-attribute {
            @apply text-blue-600;
        }
        .xml-attribute-value {
            @apply text-green-600;
        }
    </style>
    <script>
        // Add this at the start of your script section
        let currentMode = 'html'; // or 'json'
        
        function switchMode(mode) {
            currentMode = mode;
            const mainContent = document.querySelector('.grid');
            const heroTitle = document.getElementById('heroTitle');
            const heroSubtitle = document.getElementById('heroSubtitle');
            
            if (mode === 'json') {
                heroTitle.textContent = 'JSON Beautifier';
                heroSubtitle.textContent = 'Try JSON Editor';
                document.title = 'JSON Beautifier';
                
                mainContent.innerHTML = '<div class="lg:col-span-5">' +
                    '<div class="editor-container h-full">' +
                    '<div class="panel-header flex justify-between items-center">' +
                    '<span>JSON Input</span>' +
                    '<div class="flex items-center space-x-2">' +
                    '<button onclick="copyInput()" class="action-btn secondary" title="Copy">' +
                    '<i class="material-icons text-base">content_copy</i>' +
                    '</button>' +
                    '<button onclick="clearInput(\'jsonInput\')" class="action-btn secondary" title="Clear">' +
                    '<i class="material-icons text-base">delete</i>' +
                    '</button>' +
                    '</div>' +
                    '</div>' +
                    '<textarea id="jsonInput" class="w-full editor-height p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" ' +
                    'placeholder="Enter your JSON here..."></textarea>' +
                    '</div>' +
                    '</div>' +
                    '<div class="lg:col-span-2 flex lg:flex-col justify-center items-center gap-3">' +
                    '<button onclick="formatJSON()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">' +
                    '<i class="material-icons">format_paint</i>' +
                    'Format JSON' +
                    '</button>' +
                    '</div>' +
                    '<div class="lg:col-span-5">' +
                    '<div class="editor-container h-full">' +
                    '<div class="panel-header flex justify-between items-center">' +
                    '<span>Formatted JSON</span>' +
                    '<div class="flex items-center space-x-2">' +
                    '<button onclick="copyOutput()" class="action-btn secondary" title="Copy">' +
                    '<i class="material-icons text-base">content_copy</i>' +
                    '</button>' +
                    '</div>' +
                    '</div>' +
                    '<div id="jsonOutput" class="w-full editor-height p-4 font-mono text-sm overflow-auto"></div>' +
                    '</div>' +
                    '</div>';
            } else if (mode === 'diff') {
                heroTitle.textContent = 'Diff Checker';
                heroSubtitle.textContent = 'Compare Text Differences';
                document.title = 'Diff Checker';
                
                mainContent.innerHTML = '<div class="lg:col-span-12">' +
                    '<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(40vh-80px)]">' +
                    '<!-- Original Text Panel -->' +
                    '<div class="editor-container h-full">' +
                    '<div class="panel-header flex justify-between items-center">' +
                    '<span>Original Text</span>' +
                    '<div class="flex items-center space-x-2">' +
                    '<button onclick="clearInput(\'originalText\')" class="action-btn secondary" title="Clear">' +
                    '<i class="material-icons text-base">delete</i>' +
                    '</button>' +
                    '</div>' +
                    '</div>' +
                    '<textarea id="originalText" class="w-full h-full p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none resize-none" ' +
                    'placeholder="Enter original text here..."></textarea>' +
                    '</div>' +
                    '<!-- Modified Text Panel -->' +
                    '<div class="editor-container h-full">' +
                    '<div class="panel-header flex justify-between items-center">' +
                    '<span>Modified Text</span>' +
                    '<div class="flex items-center space-x-2">' +
                    '<button onclick="clearInput(\'modifiedText\')" class="action-btn secondary" title="Clear">' +
                    '<i class="material-icons text-base">delete</i>' +
                    '</button>' +
                    '</div>' +
                    '</div>' +
                    '<textarea id="modifiedText" class="w-full h-full p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none resize-none" ' +
                    'placeholder="Enter modified text here..."></textarea>' +
                    '</div>' +
                    '</div>' +
                    '<!-- Compare Button -->' +
                    '<div class="flex justify-center my-4">' +
                    '<button onclick="showDiff()" class="inline-flex items-center gap-x-2 rounded-lg bg-indigo-600 px-8 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">' +
                    '<i class="material-icons">compare</i>' +
                    'Compare' +
                    '</button>' +
                    '</div>' +
                    '<!-- Diff Output Panel -->' +
                    '<div class="editor-container h-[calc(40vh-80px)]">' +
                    '<div class="panel-header flex justify-between items-center">' +
                    '<span>Differences</span>' +
                    '<div class="flex items-center space-x-2">' +
                    '<button onclick="copyDiff()" class="action-btn secondary" title="Copy">' +
                    '<i class="material-icons text-base">content_copy</i>' +
                    '</button>' +
                    '</div>' +
                    '</div>' +
                    '<div id="diffOutput" class="w-full h-full p-4 font-mono text-sm overflow-auto"></div>' +
                    '</div>' +
                    '</div>';
            } else if (mode === 'python') {
                heroTitle.textContent = 'JSON to Python';
                heroSubtitle.textContent = 'Convert JSON to Python Code';
                document.title = 'JSON to Python Converter';
                
                mainContent.innerHTML = '<div class="lg:col-span-5">' +
                    '<div class="editor-container h-full">' +
                    '<div class="panel-header flex justify-between items-center">' +
                    '<span>JSON Input</span>' +
                    '<div class="flex items-center space-x-2">' +
                    '<button onclick="copyInput()" class="action-btn secondary" title="Copy">' +
                    '<i class="material-icons text-base">content_copy</i>' +
                    '</button>' +
                    '<button onclick="validateJSON()" class="action-btn secondary" title="Validate JSON">' +
                    '<i class="material-icons text-base">check</i>' +
                    '</button>' +
                    '<button onclick="clearInput(\'jsonInput\')" class="action-btn secondary" title="Clear">' +
                    '<i class="material-icons text-base">delete</i>' +
                    '</button>' +
                    '</div>' +
                    '</div>' +
                    '<textarea id="jsonInput" class="w-full editor-height p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" ' +
                    'placeholder="Enter your JSON here..."></textarea>' +
                    '</div>' +
                    '</div>' +
                    '<div class="lg:col-span-2 flex lg:flex-col justify-center items-center gap-3">' +
                    '<button onclick="convertToPython()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">' +
                    '<i class="material-icons">code</i>' +
                    'Convert to Python' +
                    '</button>' +
                    '<button onclick="downloadPython()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-gray-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">' +
                    '<i class="material-icons">download</i>' +
                    'Download .py' +
                    '</button>' +
                    '</div>' +
                    '<div class="lg:col-span-5">' +
                    '<div class="editor-container h-full">' +
                    '<div class="panel-header flex justify-between items-center">' +
                    '<span>Python Code</span>' +
                    '<div class="flex items-center space-x-2">' +
                    '<button onclick="copyOutput()" class="action-btn secondary" title="Copy">' +
                    '<i class="material-icons text-base">content_copy</i>' +
                    '</button>' +
                    '</div>' +
                    '</div>' +
                    '<div id="pythonOutput" class="w-full editor-height p-4 font-mono text-sm overflow-auto bg-gray-50"></div>' +
                    '</div>' +
                    '</div>';
            } else {
                heroTitle.textContent = 'HTML Viewer';
                heroSubtitle.textContent = 'Try HTML Editor';
                document.title = 'HTML Viewer';
                
                mainContent.innerHTML = `
                    <div class="lg:col-span-5">
                        <div class="editor-container h-full">
                            <div class="panel-header flex justify-between items-center">
                                <span>HTML Input</span>
                                <div class="flex items-center space-x-2">
                                    <button onclick="copyInput()" class="action-btn secondary" title="Copy">
                                        <i class="material-icons text-base">content_copy</i>
                                    </button>
                                    <button onclick="checkInput()" class="action-btn secondary" title="Validate">
                                        <i class="material-icons text-base">check</i>
                                    </button>
                                    <button onclick="clearInput('htmlInput')" class="action-btn secondary" title="Clear">
                                        <i class="material-icons text-base">delete</i>
                                    </button>
                                </div>
                            </div>
                            <textarea id="htmlInput" class="w-full editor-height p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" 
                                placeholder="Enter your HTML here..."></textarea>
                        </div>
                    </div>

                    <div class="lg:col-span-2 flex lg:flex-col justify-center items-center gap-3">
                        <button onclick="updatePreview()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-green-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
                            <i class="material-icons">play_arrow</i>
                            RUN
                        </button>
                        <button onclick="formatHTML()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                            <i class="material-icons">format_paint</i>
                            Format
                        </button>
                        <button onclick="downloadHTML()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-gray-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">
                            <i class="material-icons">download</i>
                            Download
                        </button>
                    </div>

                    <div class="lg:col-span-5">
                        <div class="editor-container h-full">
                            <iframe id="preview" class="w-full h-full border-none"></iframe>
                        </div>
                    </div>
                `;
            }
        }

        function formatJSON() {
            const input = document.getElementById('jsonInput');
            const output = document.getElementById('jsonOutput');
            let json = input.value.trim();
            
            try {
                const parsed = JSON.parse(json);
                output.innerHTML = '<div class="json-controls">' +
                    '<button onclick="expandAll()">Expand All</button>' +
                    '<button onclick="collapseAll()">Collapse All</button>' +
                    '</div>' +
                    '<div class="json-tree">' + renderTree(parsed) + '</div>';

                // Add the tree interaction functions
                const script = document.createElement('script');
                script.textContent = 'function toggleNode(el) {' +
                    'const content = el.nextElementSibling;' +
                    'const arrow = el.querySelector(".toggle");' +
                    'if (content.classList.contains("collapsed")) {' +
                    'content.classList.remove("collapsed");' +
                    'arrow.style.transform = "rotate(90deg)";' +
                    '} else {' +
                    'content.classList.add("collapsed");' +
                    'arrow.style.transform = "rotate(0deg)";' +
                    '}}' +
                    'function expandAll() {' +
                    'document.querySelectorAll(".collapsed").forEach(el => {' +
                    'el.classList.remove("collapsed");' +
                    '});' +
                    'document.querySelectorAll(".toggle").forEach(el => {' +
                    'el.style.transform = "rotate(90deg)";' +
                    '});}' +
                    'function collapseAll() {' +
                    'document.querySelectorAll(".json-tree .indent").forEach(el => {' +
                    'el.classList.add("collapsed");' +
                    '});' +
                    'document.querySelectorAll(".toggle").forEach(el => {' +
                    'el.style.transform = "rotate(0deg)";' +
                    '});}';
                document.body.appendChild(script);
            } catch (e) {
                output.innerHTML = '<div class="text-red-600">Invalid JSON: ' + e.message + '</div>';
            }
        }

        function renderTree(data) {
            if (data === null) {
                return '<span class="null">null</span>';
            }
            if (typeof data === 'string') {
                return '<span class="string">"' + escapeHTML(data) + '"</span>';
            }
            if (typeof data === 'number') {
                return '<span class="number">' + data + '</span>';
            }
            if (typeof data === 'boolean') {
                return '<span class="boolean">' + data + '</span>';
            }
            
            if (Array.isArray(data)) {
                if (data.length === 0) {
                    return '[]';
                }
                
                const items = data.map((item, i) => 
                    '<div class="item">' + renderTree(item) + (i < data.length - 1 ? ',' : '') + '</div>'
                ).join('');
                
                return '<div class="array">' +
                    '<div class="item" onclick="toggleNode(this)">' +
                    '<span class="toggle">▶</span>[' +
                    '<span class="array-length">' + data.length + ' items</span>' +
                    '</div>' +
                    '<div class="indent collapsed">' + items + '</div>' +
                    '<div class="item">]</div>' +
                    '</div>';
            }
            
            if (typeof data === 'object') {
                const keys = Object.keys(data);
                if (keys.length === 0) {
                    return '{}';
                }
                
                const items = keys.map((key, i) => 
                    '<div class="item">' +
                    '<span class="key">"' + escapeHTML(key) + '"</span>: ' + renderTree(data[key]) + (i < keys.length - 1 ? ',' : '') +
                    '</div>'
                ).join('');
                
                return '<div class="object">' +
                    '<div class="item" onclick="toggleNode(this)">' +
                    '<span class="toggle">▶</span>{' +
                    '<span class="object-length">' + keys.length + ' keys</span>' +
                    '</div>' +
                    '<div class="indent collapsed">' + items + '</div>' +
                    '<div class="item">}</div>' +
                    '</div>';
            }
            
            return String(data);
        }

        function escapeHTML(str) {
            var div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function showDiff() {
            const originalText = document.getElementById('originalText').value;
            const modifiedText = document.getElementById('modifiedText').value;
            const diffOutput = document.getElementById('diffOutput');
            
            if (!originalText && !modifiedText) {
                diffOutput.innerHTML = '<div class="text-gray-500 text-center p-4">Enter text in both panels to compare differences</div>';
                return;
            }
            
            if (!originalText || !modifiedText) {
                diffOutput.innerHTML = '<div class="text-red-600">Please enter text in both panels to compare</div>';
                return;
            }
            
            try {
                // Check if diff_match_patch is loaded
                if (typeof diff_match_patch === 'undefined') {
                    throw new Error('Diff library not loaded. Please refresh the page and try again.');
                }

                const dmp = new diff_match_patch();
                if (!dmp) {
                    throw new Error('Failed to initialize diff tool. Please refresh the page and try again.');
                }

                const diffs = dmp.diff_main(originalText, modifiedText);
                dmp.diff_cleanupSemantic(diffs);
                
                let html = '<div class="diff-view">';
                let lineNumber = 1;
                let currentLine = '';
                let diffType = null;
                
                // Process diffs line by line
                diffs.forEach(([type, text]) => {
                    const lines = text.split('\n');
                    
                    lines.forEach((line, index) => {
                        const isLastLine = index === lines.length - 1;
                        
                        // Handle empty lines
                        if (!line && !isLastLine) {
                            if (diffType !== null) {
                                // Output the current line before starting a new one
                                html += formatDiffLine(currentLine, diffType, lineNumber);
                                currentLine = '';
                                diffType = null;
                                lineNumber++;
                            }
                            // Output empty line
                            html += formatDiffLine('', type, lineNumber);
                            lineNumber++;
                            return;
                        }
                        
                        // If we're starting a new diff type or line
                        if (diffType === null) {
                            diffType = type;
                            currentLine = line;
                        } else if (diffType === type) {
                            // Same diff type, append to current line
                            currentLine += line;
                        } else {
                            // Different diff type, output current line and start new one
                            html += formatDiffLine(currentLine, diffType, lineNumber);
                            currentLine = line;
                            diffType = type;
                        }
                        
                        // If this is the last line of the current diff segment
                        if (isLastLine) {
                            if (currentLine || type === 0) { // Output if there's content or it's an unchanged line
                                html += formatDiffLine(currentLine, diffType, lineNumber);
                                lineNumber++;
                            }
                            currentLine = '';
                            diffType = null;
                        }
                    });
                });
                
                html += '</div>';
                
                // Add styles for the diff view
                const styles = '<style>' +
                    '.diff-view { font-family: ui-monospace, monospace; font-size: 14px; line-height: 1.5; }' +
                    '.diff-line { white-space: pre-wrap; word-wrap: break-word; margin: 2px 0; padding: 0 8px; }' +
                    '.diff-added { background: #dcfce7; color: #166534; }' +
                    '.diff-removed { background: #fee2e2; color: #991b1b; }' +
                    '.diff-unchanged { background: transparent; }' +
                    '.line-number { color: #6b7280; user-select: none; padding-right: 16px; margin-right: 16px; ' +
                    'border-right: 1px solid #e5e7eb; display: inline-block; width: 48px; text-align: right; }' +
                    '</style>';
                
                diffOutput.innerHTML = styles + html;
            } catch (error) {
                console.error('Error in showDiff:', error);
                diffOutput.innerHTML = '<div class="text-red-600">Error comparing texts: ' + error.message + '</div>';
            }
        }

        function formatDiffLine(text, type, lineNumber) {
            const escapedText = escapeHTML(text);
            const diffClass = type === 0 ? 'diff-unchanged' : (type === 1 ? 'diff-added' : 'diff-removed');
            return '<div class="diff-line ' + diffClass + '">' +
                '<span class="line-number">' + lineNumber + '</span>' +
                escapedText +
                '</div>';
        }

        function copyInput() {
            const input = document.getElementById('jsonInput');
            input.select();
            document.execCommand('copy');
        }

        function copyOutput() {
            const output = document.getElementById('jsonOutput');
            if (output) {
                const range = document.createRange();
                range.selectNode(output);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand('copy');
                window.getSelection().removeAllRanges();
            }
        }

        function clearInput(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                input.value = '';
            }
        }

        function checkInput() {
            const input = document.getElementById('htmlInput').value;
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(input, 'text/html');
                const errors = doc.getElementsByTagName('parsererror');
                if (errors.length > 0) {
                    throw new Error('Invalid HTML');
                }
                alert('HTML is valid!');
            } catch (e) {
                alert('Invalid HTML: ' + e.message);
            }
        }

        function updatePreview() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            const html = input.value.trim();
            
            if (html) {
                preview.contentDocument.open();
                preview.contentDocument.write(html);
                preview.contentDocument.close();
            } else {
                preview.contentDocument.open();
                preview.contentDocument.write('<p class="text-gray-500 text-center p-4">Click RUN to preview your HTML</p>');
                preview.contentDocument.close();
            }
        }

        function formatHTML() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            let html = input.value;
            
            try {
                // Parse the HTML using DOMParser
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Format the complete HTML document
                let formatted = '';
                
                // Add DOCTYPE if present
                if (html.toLowerCase().includes('<!doctype')) {
                    formatted += '<!DOCTYPE html>\n';
                }
                
                // Format the rest of the document
                formatted += formatNode(doc.documentElement, 0);
                
                // Display formatted HTML in the preview
                preview.contentDocument.open();
                preview.contentDocument.write(`
                    <pre style="margin: 0; padding: 16px; font-family: monospace; white-space: pre-wrap; font-size: 14px; line-height: 1.5; background: #f8f9fa;">
                        ${formatted.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                    </pre>
                `);
                preview.contentDocument.close();
            } catch (e) {
                alert('Error formatting HTML: ' + e.message);
            }
        }

        // Helper function to format HTML nodes
        function formatNode(node, level) {
            if (!node) return '';
            
            let result = '';
            const indent = '    '.repeat(level);

            // Handle text nodes
            if (node.nodeType === 3) {
                const text = node.textContent.trim();
                if (text) {
                    result += indent + text + '\n';
                }
                return result;
            }

            // Handle element nodes
            if (node.nodeType === 1) {
                const tagName = node.tagName.toLowerCase();
                
                // Get node attributes
                const attrs = Array.from(node.attributes)
                    .map(attr => `${attr.name}="${attr.value}"`)
                    .join(' ');

                // Special handling for style and script tags to preserve content formatting
                if (tagName === 'style' || tagName === 'script') {
                    result += indent + '<' + tagName + (attrs ? ' ' + attrs : '') + '>\n';
                    if (node.textContent.trim()) {
                        result += indent + '    ' + node.textContent.trim() + '\n';
                    }
                    result += indent + '</' + tagName + '>\n';
                    return result;
                }

                // Opening tag
                result += indent + '<' + tagName + 
                    (attrs ? ' ' + attrs : '') + 
                    (node.children.length || node.textContent.trim() ? '>\n' : '/>\n');

                // Handle children
                for (let child of node.childNodes) {
                    result += formatNode(child, level + 1);
                }

                // Closing tag if needed
                if (node.children.length || node.textContent.trim()) {
                    result += indent + '</' + tagName + '>\n';
                }
            }

            return result;
        }

        function downloadHTML() {
            const html = document.getElementById('htmlInput').value;
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'formatted.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function copyDiff() {
            const diffOutput = document.getElementById('diffOutput');
            const range = document.createRange();
            range.selectNode(diffOutput);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
        }

        function validateJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) {
                alert('Please enter JSON to validate');
                return;
            }
            
            try {
                JSON.parse(input);
                alert('Valid JSON!');
            } catch (e) {
                alert('Invalid JSON: ' + e.message);
            }
        }

        function convertToPython() {
            const input = document.getElementById('jsonInput');
            const output = document.getElementById('pythonOutput');
            let json = input.value.trim();
            
            if (!json) {
                output.innerHTML = '<div class="text-gray-500 text-center p-4">Enter JSON to convert to Python</div>';
                return;
            }
            
            try {
                const parsed = JSON.parse(json);
                const python = jsonToPython(parsed, 0);
                
                // Add syntax highlighting
                output.innerHTML = '<pre class="python-code">' +
                    python.replace(/(".*?")/g, '<span class="text-green-600">$1</span>')
                          .replace(/\b(True|False|None)\b/g, '<span class="text-purple-600">$1</span>')
                          .replace(/(\[|\]|\{|\}|\(|\))/g, '<span class="text-amber-600">$1</span>')
                          .replace(/(:)/g, '<span class="text-blue-600">$1</span>') +
                    '</pre>';
            } catch (e) {
                output.innerHTML = '<div class="text-red-600">Error converting to Python: ' + e.message + '</div>';
            }
        }

        function jsonToPython(obj, indent = 0) {
            const indentStr = '    '.repeat(indent);
            
            if (obj === null) {
                return 'None';
            }
            
            if (typeof obj === 'boolean') {
                return obj ? 'True' : 'False';
            }
            
            if (typeof obj === 'string') {
                // Escape quotes and special characters
                const escaped = obj.replace(/\\/g, '\\\\')
                                  .replace(/"/g, '\\"')
                                  .replace(/\n/g, '\\n')
                                  .replace(/\r/g, '\\r')
                                  .replace(/\t/g, '\\t');
                return `"${escaped}"`;
            }
            
            if (typeof obj === 'number') {
                return obj.toString();
            }
            
            if (Array.isArray(obj)) {
                if (obj.length === 0) {
                    return '[]';
                }
                
                const items = obj.map(item => jsonToPython(item, indent + 1));
                
                if (items.join(', ').length <= 80) {
                    return `[${items.join(', ')}]`;
                }
                
                return '[\n' +
                    items.map(item => indentStr + '    ' + item).join(',\n') +
                    '\n' + indentStr + ']';
            }
            
            if (typeof obj === 'object') {
                const keys = Object.keys(obj);
                if (keys.length === 0) {
                    return '{}';
                }
                
                const items = keys.map(key => {
                    const keyStr = /^[a-zA-Z_][a-zA-Z0-9_]*$/.test(key) ? key : `"${key}"`;
                    return `${keyStr}: ${jsonToPython(obj[key], indent + 1)}`;
                });
                
                if (items.join(', ').length <= 80) {
                    return `{${items.join(', ')}}`;
                }
                
                return '{\n' +
                    items.map(item => indentStr + '    ' + item).join(',\n') +
                    '\n' + indentStr + '}';
            }
            
            return String(obj);
        }

        function downloadPython() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) {
                alert('Please enter JSON to convert');
                return;
            }
            
            try {
                const parsed = JSON.parse(input);
                const python = 'data = ' + jsonToPython(parsed, 0);
                
                const blob = new Blob([python], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'converted.py';
                a.click();
                window.URL.revokeObjectURL(url);
            } catch (e) {
                alert('Error converting to Python: ' + e.message);
            }
        }
    </script>
</head>
<body class="antialiased">
    <header class="bg-white shadow-sm h-16">
        <nav class="mx-auto flex max-w-7xl items-center justify-between p-4 lg:px-8" aria-label="Global">
            <div class="flex lg:flex-1">
                <a href="#" class="-m-1.5 p-1.5 text-xl font-semibold leading-6 text-gray-900">
                    Text Formatter
                </a>
            </div>
            <div class="flex lg:gap-x-8">
                <a href="#" onclick="switchMode('html')" class="text-sm font-semibold leading-6 text-gray-900 hover:text-indigo-600">HTML BEAUTIFIER</a>
                <a href="#" onclick="switchMode('json')" class="text-sm font-semibold leading-6 text-gray-900 hover:text-indigo-600">JSON BEAUTIFIER</a>
                <a href="#" onclick="switchMode('diff')" class="text-sm font-semibold leading-6 text-gray-900 hover:text-indigo-600">DIFF CHECKER</a>
                <a href="#" onclick="switchMode('python')" class="text-sm font-semibold leading-6 text-gray-900 hover:text-indigo-600">JSON TO PYTHON</a>
                <div class="relative group">
                    <button type="button" class="flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900" aria-expanded="false">
                        MORE
                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <div class="absolute -right-8 top-full z-10 mt-3 w-40 rounded-xl bg-white p-2 shadow-lg ring-1 ring-gray-900/5 hidden group-hover:block">
                        <a href="#" class="block rounded-lg px-3 py-2 text-sm font-semibold leading-6 text-gray-900 hover:bg-gray-50">JS BEAUTIFIER</a>
                        <a href="#" class="block rounded-lg px-3 py-2 text-sm font-semibold leading-6 text-gray-900 hover:bg-gray-50">YAML FORMATTER</a>
                        <a href="#" class="block rounded-lg px-3 py-2 text-sm font-semibold leading-6 text-gray-900 hover:bg-gray-50">SQL FORMATTER</a>
                        <a href="#" class="block rounded-lg px-3 py-2 text-sm font-semibold leading-6 text-gray-900 hover:bg-gray-50">MARKDOWN EDITOR</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="h-full px-4 py-4 sm:px-6 lg:px-8">
            <div class="rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 p-6 shadow-xl mb-4">
                <h2 id="heroTitle" class="text-3xl font-bold tracking-tight text-white sm:text-4xl">HTML Viewer</h2>
                <p id="heroSubtitle" class="mt-2 text-lg text-blue-100">Try HTML Editor</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 h-full">
                <!-- Input Panel -->
                <div class="lg:col-span-5">
                    <div class="editor-container h-full">
                        <div class="panel-header flex justify-between items-center">
                            <span id="inputLabel">HTML Input</span>
                            <div class="flex items-center space-x-2">
                                <button onclick="copyInput()" class="action-btn secondary" title="Copy">
                                    <i class="material-icons text-base">content_copy</i>
                                </button>
                                <button onclick="checkInput()" class="action-btn secondary" title="Validate">
                                    <i class="material-icons text-base">check</i>
                                </button>
                                <button onclick="clearInput()" class="action-btn secondary" title="Clear">
                                    <i class="material-icons text-base">delete</i>
                                </button>
                            </div>
                        </div>
                        <textarea id="htmlInput" class="w-full editor-height p-4 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Enter your HTML here..."></textarea>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="lg:col-span-2 flex lg:flex-col justify-center items-center gap-3">
                    <button id="runBtn" onclick="updatePreview()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-green-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
                        <i class="material-icons">play_arrow</i>
                        RUN
                    </button>
                    <button id="formatBtn" onclick="formatHTML()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-indigo-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                        <i class="material-icons">format_paint</i>
                        Format
                    </button>
                    <button id="downloadBtn" onclick="downloadHTML()" class="w-full inline-flex justify-center items-center gap-x-2 rounded-lg bg-gray-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600">
                        <i class="material-icons">download</i>
                        Download
                    </button>
                </div>

                <!-- Output Panel -->
                <div class="lg:col-span-5">
                    <div class="editor-container h-full" id="rightPanel">
                        <iframe id="preview" class="w-full h-full border-none"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Remove the automatic preview update on input
        document.getElementById('htmlInput').removeEventListener('input', updatePreview);

        function updatePreview() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            const html = input.value.trim();
            
            if (html) {
                preview.contentDocument.open();
                preview.contentDocument.write(html);
                preview.contentDocument.close();
            } else {
                preview.contentDocument.open();
                preview.contentDocument.write('<p class="text-gray-500 text-center p-4">Click RUN to preview your HTML</p>');
                preview.contentDocument.close();
            }
        }

        // Initialize with empty preview message
        window.onload = function() {
            const preview = document.getElementById('preview');
            preview.contentDocument.open();
            preview.contentDocument.write('<p class="text-gray-500 text-center p-4">Click RUN to preview your HTML</p>');
            preview.contentDocument.close();
        };

        function formatHTML() {
            const input = document.getElementById('htmlInput');
            const preview = document.getElementById('preview');
            let html = input.value;
            
            try {
                // Parse the HTML using DOMParser
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Format the complete HTML document
                let formatted = '';
                
                // Add DOCTYPE if present
                if (html.toLowerCase().includes('<!doctype')) {
                    formatted += '<!DOCTYPE html>\n';
                }
                
                // Format the rest of the document
                formatted += formatNode(doc.documentElement, 0);
                
                // Display formatted HTML in the preview
                preview.contentDocument.open();
                preview.contentDocument.write(`
                    <pre style="margin: 0; padding: 16px; font-family: monospace; white-space: pre-wrap; font-size: 14px; line-height: 1.5; background: #f8f9fa;">
                        ${formatted.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                    </pre>
                `);
                preview.contentDocument.close();
            } catch (e) {
                alert('Error formatting HTML: ' + e.message);
            }
        }

        // Helper function to format HTML nodes
        function formatNode(node, level) {
            if (!node) return '';
            
            let result = '';
            const indent = '    '.repeat(level);

            // Handle text nodes
            if (node.nodeType === 3) {
                const text = node.textContent.trim();
                if (text) {
                    result += indent + text + '\n';
                }
                return result;
            }

            // Handle element nodes
            if (node.nodeType === 1) {
                const tagName = node.tagName.toLowerCase();
                
                // Get node attributes
                const attrs = Array.from(node.attributes)
                    .map(attr => `${attr.name}="${attr.value}"`)
                    .join(' ');

                // Special handling for style and script tags to preserve content formatting
                if (tagName === 'style' || tagName === 'script') {
                    result += indent + '<' + tagName + (attrs ? ' ' + attrs : '') + '>\n';
                    if (node.textContent.trim()) {
                        result += indent + '    ' + node.textContent.trim() + '\n';
                    }
                    result += indent + '</' + tagName + '>\n';
                    return result;
                }

                // Opening tag
                result += indent + '<' + tagName + 
                    (attrs ? ' ' + attrs : '') + 
                    (node.children.length || node.textContent.trim() ? '>\n' : '/>\n');

                // Handle children
                for (let child of node.childNodes) {
                    result += formatNode(child, level + 1);
                }

                // Closing tag if needed
                if (node.children.length || node.textContent.trim()) {
                    result += indent + '</' + tagName + '>\n';
                }
            }

            return result;
        }

        function downloadHTML() {
            const html = document.getElementById('htmlInput').value;
            const blob = new Blob([html], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'formatted.html';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function copyInput() {
            const input = document.getElementById('htmlInput');
            input.select();
            document.execCommand('copy');
        }

        function copyOutput() {
            const preview = document.getElementById('preview');
            const content = preview.contentDocument.documentElement.outerHTML;
            const textarea = document.createElement('textarea');
            textarea.value = content;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        function clearInput() {
            document.getElementById('htmlInput').value = '';
            updatePreview();
        }

        function checkInput() {
            const input = document.getElementById('htmlInput').value;
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(input, 'text/html');
                const errors = doc.getElementsByTagName('parsererror');
                if (errors.length > 0) {
                    throw new Error('Invalid HTML');
                }
                alert('HTML is valid!');
            } catch (e) {
                alert('Invalid HTML: ' + e.message);
            }
        }

        let isFullscreen = false;
        function toggleFullscreen() {
            const previewContainer = document.getElementById('preview').parentElement.parentElement;
            if (!isFullscreen) {
                previewContainer.classList.remove('lg:col-span-5');
                previewContainer.classList.add('lg:col-span-7');
            } else {
                previewContainer.classList.remove('lg:col-span-7');
                previewContainer.classList.add('lg:col-span-5');
            }
            isFullscreen = !isFullscreen;
        }
    </script>
</body>
</html>
